# Motor Control with Microcontroller
#### Jingyan Ling
#### - March 2019

## Description of project

This repo is a simple mechatronics project that uses PIC32 to control motor through PID. The project allow the motor to move to certain position (in degree) without overshoot and in a reasonable range of raise time. Besides that, the motor is allowed to move along user input trajectory as well. The microcontroller keeps tracking motor positions and input current by adapting two feedback loops. It sends required current to motor through H-bridge and sends data back to computer so it can plot and show performance of such controller parameters.

## Hardware
- Brushed DC motor with encoder
- NU32 microcontroller board (PIC32)
- Decoder counting chip
- MAX9918 current sensor
- DRV8835 H-bridge
- Passive electrical elements
  
## Software
- Matlab
- gcc compiler
  
## Circuit Diagram
![mechatronics_circuit](https://github.com/monkalynn813/motor_control_with_pic32/blob/master/img/mechatronics_circuit.png)

## Brief Description of Modules
- `client.m`: Matlab User Interface
- `main.c`: This script contains two loops, PD and PID controller, through ISR interrupts. It responds to user's input command through switch-case as well.
- `encoder.c`: This script contains functions reading current motor positions
- `isense.c`: This script contains functions reading current current in mA.
- `currentcontrol.c`: This script contains IRQ information to initialize inner loop ISR in main.c. It also contains functions of PD controller for current control.
- `positioncontrol.c`: This script contains IRQ information to initialize outer loop ISR in main.c. It also contains functions of PID controller for motor position control.

## Inner (Current PD Feedback Control) loop performance
![PI_response](https://github.com/monkalynn813/motor_control_with_pic32/blob/master/img/PI_response.jpg)

## Final performance 
### Stepped trajectory
- blue line for reference generated by user input trajectory
- orange line for actual performance of brushed motor
![step final](https://github.com/monkalynn813/motor_control_with_pic32/blob/master/img/step%20final.jpg)

### Cubic trajectory
- blue line for reference generated by user input trajectory
- orange line for actual performance of brushed motor
![cubic final](https://github.com/monkalynn813/motor_control_with_pic32/blob/master/img/cubic%20final.jpg) 

## Demonstration Video
- One can find Demo Video [here](https://youtu.be/KC1MuiPBfsM)

